{% extends 'shop/base.html' %}
{% load static %}

{% block title %}My Orders - Pavan Diary{% endblock %}

{% block content %}
<div class="page-header" style="background: linear-gradient(135deg, #2c5f2d, #1e4620); color: white; padding: 3rem 0; margin: -2rem -2rem 3rem -2rem; text-align: center;">
    <h1 style="color: white;">ğŸ“¦ My Orders</h1>
    <p>Track and manage your orders</p>
</div>

{% if orders %}
<div style="margin-bottom: 2rem;">
    <div style="display: flex; gap: 1rem; overflow-x: auto; padding: 0.5rem 0;">
        <a href="?status=all" class="badge {% if not request.GET.status or request.GET.status == 'all' %}badge-primary{% else %}badge-secondary{% endif %}" 
           style="padding: 0.5rem 1rem; text-decoration: none; white-space: nowrap;">
            All Orders ({{ orders.count }})
        </a>
        <a href="?status=pending" class="badge {% if request.GET.status == 'pending' %}badge-warning{% else %}badge-secondary{% endif %}" 
           style="padding: 0.5rem 1rem; text-decoration: none; white-space: nowrap;">
            Pending
        </a>
        <a href="?status=confirmed" class="badge {% if request.GET.status == 'confirmed' %}badge-info{% else %}badge-secondary{% endif %}" 
           style="padding: 0.5rem 1rem; text-decoration: none; white-space: nowrap;">
            Confirmed
        </a>
        <a href="?status=shipped" class="badge {% if request.GET.status == 'shipped' %}badge-primary{% else %}badge-secondary{% endif %}" 
           style="padding: 0.5rem 1rem; text-decoration: none; white-space: nowrap;">
            Shipped
        </a>
        <a href="?status=delivered" class="badge {% if request.GET.status == 'delivered' %}badge-success{% else %}badge-secondary{% endif %}" 
           style="padding: 0.5rem 1rem; text-decoration: none; white-space: nowrap;">
            Delivered
        </a>
        <a href="?status=cancelled" class="badge {% if request.GET.status == 'cancelled' %}badge-danger{% else %}badge-secondary{% endif %}" 
           style="padding: 0.5rem 1rem; text-decoration: none; white-space: nowrap;">
            Cancelled
        </a>
    </div>
</div>

<div style="display: grid; gap: 2rem;">
    {% for order in orders %}
    <div class="order-card">
        <div class="order-header">
            <div>
                <div class="order-number">Order #{{ order.order_number }}</div>
                <div style="color: #666; font-size: 0.9rem; margin-top: 0.25rem;">
                    ğŸ“… Placed on {{ order.created_at|date:"F d, Y" }} at {{ order.created_at|time:"h:i A" }}
                </div>
            </div>
            <div style="text-align: right;">
                <span class="order-status {{ order.status }}">{{ order.get_status_display }}</span>
                <div style="margin-top: 0.5rem;">
                    <span class="badge {% if order.payment_status == 'completed' %}badge-success{% else %}badge-warning{% endif %}">
                        ğŸ’³ {{ order.payment_status|title }}
                    </span>
                </div>
            </div>
        </div>

        <div style="padding: 1.5rem 0; border-top: 1px solid #e0e0e0; border-bottom: 1px solid #e0e0e0;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                <div>
                    <div style="color: #666; font-size: 0.9rem; margin-bottom: 0.25rem;">Items</div>
                    <div style="font-weight: 600;">{{ order.items.count }} product{{ order.items.count|pluralize }}</div>
                </div>
                <div>
                    <div style="color: #666; font-size: 0.9rem; margin-bottom: 0.25rem;">Total Amount</div>
                    <div style="font-weight: 600; color: #2c5f2d; font-size: 1.3rem;">â‚¹{{ order.total_amount }}</div>
                </div>
                <div>
                    <div style="color: #666; font-size: 0.9rem; margin-bottom: 0.25rem;">Payment Method</div>
                    <div style="font-weight: 600;">{{ order.payment_method }}</div>
                </div>
            </div>

            <!-- Order Items Preview -->
            <div style="margin-top: 1.5rem;">
                <div style="display: flex; gap: 1rem; overflow-x: auto;">
                    {% for item in order.items.all|slice:":3" %}
                    <div style="min-width: 150px;">
                        <div style="background: #f8f9fa; padding: 0.75rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ¥›</div>
                            <div style="font-size: 0.85rem; font-weight: 600;">{{ item.product.name|truncatewords:3 }}</div>
                            <div style="font-size: 0.75rem; color: #666;">Qty: {{ item.quantity }}</div>
                        </div>
                    </div>
                    {% endfor %}
                    {% if order.items.count > 3 %}
                    <div style="min-width: 100px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px;">
                        <div style="text-align: center; color: #666;">
                            <div style="font-size: 1.5rem;">+{{ order.items.count|add:"-3" }}</div>
                            <div style="font-size: 0.75rem;">more</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div style="padding-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
            <a href="{% url 'order_detail' order.id %}" class="btn">ğŸ“„ View Details</a>
            
            {% if order.status == 'delivered' %}
            <button class="btn btn-outline">â­ Rate Products</button>
            {% endif %}
            
            {% if order.status in 'pending,confirmed' %}
            <button class="btn btn-danger btn-outline" onclick="return confirm('Are you sure you want to cancel this order?')">
                âŒ Cancel Order
            </button>
            {% endif %}
            
            <a href="#" class="btn btn-outline">ğŸ’¬ Contact Support</a>
        </div>
    </div>
    {% endfor %}
</div>

{% else %}
<div class="empty-state">
    <div class="empty-state-icon">ğŸ“¦</div>
    <h2>No orders found</h2>
    <p>You haven't placed any orders yet. Start shopping to see your orders here!</p>
    <a href="{% url 'product_list' %}" class="btn btn-lg">Start Shopping</a>
</div>
{% endif %}
{% endblock %}